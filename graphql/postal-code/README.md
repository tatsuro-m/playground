## これは何
郵便番号を入力するとその結果が返ってくる GraphQL API を作成する。

## データのセットアップ
1. https://www.post.japanpost.jp/zipcode/dl/roman-zip.html から csv をダウンロードする。
2. seed を動かす（12万件以上あるので完了まで30分以上かかる）
```shell
$ docker compose run --rm seed sh
# go run ./cmd/seed/main.go 
```

## できること
- 郵便番号 -> 住所
- 住所 -> 郵便番号
の取得。細かい部分はゴールデンテスト参照。

## テストに関する注意点
`go test -v ./...` などでまとめて実行した時に DB データの競合が起きて失敗する。  
パッケージごとに並列実行されるのを回避するために、とりあえず `-p 1` オプションを付けること。

## 元データについて
- 郵便番号は重複する
- `town_areas` の漢字が同じでローマ字だけ違うパターンもある

## データ取り込みパフォーマンス改善
現状、０から import すると完了まで18分ぐらいかかるので、これをアルゴリズムの力で改善していきたい。

### 依存関係
`prefectures` <- `municipalities` <- `town_areas` <- `postal_codes` となっている。

### 前回行の実行分を保存しておいて SQL を減らす方法
- 一行ずつ読んでいって、現在処理している row と前回実行分の row を構造体に入れる（１行の処理が終わったタイミングで現在の row は前回の row に代入される）
- 各テーブルが依存するテーブルの主キーは INSERT する時に外部キーでどうしても必要になるので、これはループの時に構造体に入れて参照できるようにする
- 前回と今回の row を比較して、県や市区町村が同じなら SELECT しないで保存しておいた Row を使って INSERT する
  - 異なる場合には、既に存在するかチェックして INSERT してみたいなことをするしかない
